---
title: "如何写没有bug的代码"
date: 2021-12-04T23:31:51+08:00
url: "/internet/how_to_code_without_bug"
isCJKLanguage: true
draft: false
toc:  true
keywords:
  - 没有bug的代码
authors:
  - cristo
---





## 什么是MakerDAO

MakerDAO是一个**自动化抵押贷款平台**，可以将物品（主要是电子货币）进行抵押以换取稳定币`Dai`。早期只支持一种抵押物——`ETH`，后续逐渐增加了其他电子货币（如`BTC`）以及现实资产。

## 解决的痛点是什么

- 基于区块链衍生出的货币本身没有稳定的价值，因此价格波动很大，MakerDAO设计了Dai实现了对美元的软锚定。
- 传统的借贷系统依赖于信用体系，而信用体系需要用户数据做支撑。MakerDAO是一个仅需抵押物（无关信用、无偏见）的借贷平台。

## 两种货币

### Dai

Dai 是一种**软锚定**美元的**资产担保型加密货币**。当借贷人将物品抵押后，会获得一定数额的Dai。

在早期阶段，MakerDAO仅支持ETH抵押物，借贷人通过CDP合约抵押以太，生成一定的Dai。

### MKR

MKR是一种治理型token，持有人能够参与Maker Protocol的制定。

借贷人赎回抵押物时，除了原本获得的Dai外，还要支付利息，这个利息需要使用MKR进行支付。

## 借贷流程简述

### 抵押

通过抵押物品来换取Dai，置换到的Dai的价格往往低于抵押物品的当前价格，以避免抵押物品的价格下降导致的债务人违约。

### 赎回

债务人可以通过支付Dai以及利息（使用MKR）来赎回抵押物品。

### 清算

当抵押物的价格下降到低于安全值后，将自动启动拍卖，以从市场中回购Dai。

如果拍卖部分抵押物即可足够偿还债务以及罚金（罚金用于鼓励债务人进行赎回），那么会将剩余抵押物归还给债务人。

回购的Dai将被销毁，以降低供应量。

**抵押物主要拍卖参数**

- 每批规模：将一笔大的抵押物拆分称多笔拍卖，每笔拍卖的价格不应太大——鼓励更多的清算人参与，也不应太低——减少拆分数量以尽快完成拍卖。
- 每次竞价时长（10mins->6hours）：每次报价太长则增加货币风险，减少竞拍者的资金流动；太短导致流拍或者参与人太少（比如以太坊网络堵塞导致流拍）
- 最小竞价增幅（3%）：限制最小的竞价增幅以避免投机者在最后一刻以非常小的增幅涨价
- 最长竞价周期（3days）

## 实现软锚定

Dai与美元1:1软锚定的机制，其实现软锚定通过：

### 无形的手——投机者套利

- Dai是通过抵押置换出来的token，此时Dai的价格锚定为1美元
- 借贷人进行**赎回**时需要使用**同样数量的Dai**进行置换
- 如果**抵押**时Dai市场价格较**高**，**赎回**时Dai市场价格较**低**，这样借贷人就能通过**抵押-赎回**来**获利**
- 如果**抵押**时Dai市场价格较低，**赎回**时Dai市场价格较**高**，这样借贷人通过**抵押-赎回**就会**亏损**
- 正常的借贷人是有真正的抵押需求，而不是以通过抵押-赎回获利为目的
- 少部分**投机者**会通过抵押-赎回进行**获利**——在Dai市场价格**高于1美元**的时候进行抵押，再**将Dai卖到市场**，此时市场中的**供给增多**，Dai**价格下降**；**低于1美元**的进行赎回，需要**从市场中买回Dai**，此时市场中**供给减少**，Dai**价格上升**。
- **投机者通过抵押-赎回获利的方式维持了Dai价格的稳定。**

![](https://raw.githubusercontent.com/stong1994/images/master/picgo/20220531135839.png)

### DSR调整

DSR是Dai的存储利率（Dai Savings Rate），当存储利率高时，持有者偏向于持有；当存储利率低时，持有者偏向于卖出。

通过调整存储利率，能够调整市场中的Dai的供给量和需求量，从而达到调整Dai的市场价格的目的。

作为一个去中心化项目，存储利率的调整靠的是MKR的持有者达成共识。

### 利息率调整

*利息率在MakerDAO中称为稳定费（Stability Fees），主要用来控制不同抵押物的抵押风险。*

借贷人抵押物品后，需要支付额外的利息，通过减少利息率，可以刺激借贷人进行借贷，从而增大Dai的供应量；通过增大利息率，可以抑制借贷人的借贷欲望，从而减少Dai的供应量。

这一策略只能在短期内生效，因为借贷人迟早会将借贷的Dai数量“归还”，因此市场中的Dai总量不变。

### 与其他稳定币挂钩

通过PSM合约，用户可以使用一个固定的比率来交换其他稳定币，这增大了稳定币的总量，降低了单个稳定币波动的概率。

### 激励社区内的人积极治理

MRK持有者作为治理的参与者，其利益与整个社区的发展成功与否挂钩。

当社区发展良好时，比如说借贷人正常借贷并赎回，会产生大量的Dai盈余；当社区发展较差时，比如清算产生了大量坏账。当Dai过剩或者坏账数量超过一个阈值后，协议将以智能合约的方式购买并燃烧MKR释放过剩Dai或者通过制造、出售MKR来弥补坏账。前者会导致市场中的MKR供给数量降低以提高价格，后者反之。

因此，积极参与社区治理有利于个人利益。

### 紧急关停

在关键时刻可以通过紧急关停来避免被攻击



## 总结

2017年12月份上线

## 问题

### ETH、BTC本身就有价格，为何还要进行抵押?

ETH和BTC虽然具有价格，但是价格波动很大。假设小明ALL IN BTC，期望BTC能够升值，但是目前急需一笔资金做周转（假设周转周期为30天），这时候小明只能将BTC卖掉一部分来换取法币，如果BTC在这30天进行了升值，那么这部分升值就成了小明的“亏损”。

如果小明通过对BTC进行抵押以换取Dai，30天后再赎回BTC，就不会“亏损”BTC在这30天内的升值。

在这个场景里，ETH、BTC并不是我们常用的货币，而是成了一件收藏品，具有波动的价值，而通过“当铺”进行抵押实现了**即拥有其所有权，又能够临时获取一笔现金做周转**。



## 名词解释

- CDP：Collateralized Debt Position, 担保债仓，是一个智能合约，用来质押ETH来生成Dai。
- SCD: Single-Collateral DAI, 单担保Dai，又称Sai。早期只支持质押ETH，因此为单担保。
- MCD：Multi-Collateral DAI, 多担保Dai。
- Liquidation Ratio：清算率
- Maker Protocol：Maker协议，MakerDAO中的所有设计概念的总称。
- DST: Dai Saving Rate, DSR能够使Dai持有人通过锁定Dai到DSR合约来赚取利息。







## 相关资源

- [MakerDAO白皮书](https://makerdao.com/zh-CN/whitepaper)
- [MakerDAO 引入现实资产指南与案例](https://blog.makerdao.com/makerdao-%E5%BC%95%E5%85%A5%E7%8E%B0%E5%AE%9E%E8%B5%84%E4%BA%A7%E6%8C%87%E5%8D%97%E4%B8%8E%E6%A1%88%E4%BE%8B/)

- [Dai 你全面了解 MakerDAO](https://imtoken.fans/t/topic/40883)

- [Dai Stats](https://daistats.com/#/)

- [Coinbase removes ‘backed by US dollars’ claim for USDC stablecoin](https://cointelegraph.com/news/coinbase-removes-backed-by-us-dollars-claim-for-usdc-stablecoin)