+++

date = 2022-03-25T15:58:00+08:00
title = "在浏览器访问一个网址都经历了哪些"
url = "/internet/internet/browser_visit"

trash = true

toc = true

+++

## 建立套接字

访问网址的过程就是客户端与服务器交互数据的过程。

套接字是连接应用程序与网络协议栈的接口，服务端与客户端通过两端的套接字形成了一条连接，两端的数据通过这条连接进行传输。

客户端可以在发起请求时再建立套接字，但服务端必须在客户端发起请求前建立好套接字。

套接字是一块存放控制信息的内存空间，这些控制信息包括：IP地址、端口号、状态等。

服务端在创建后，就会创建套接字来监听、等待客户端的连接请求。客户端在发起请求时也会先创建套接字，然后通过套接字发起请求

## 根据域名查找IP

为了方便人们记忆，网站往往都会申请一个域名，而网络层使用IP地址作为目的地标识，因为需要将域名转化为IP。

### 域名转IP的查找流程

基本的流程如下：

1. 浏览器的程序内存
2. 操作系统缓存
3. 本地的host文件
4. 域名系统

域名系统是一个层级的分布式系统，最顶层为根域名，每台计算机上都会记录根域名地址。

当计算机在本地找不到域名对应的IP后，会向最近的域名服务商发起请求。如果这个域名服务商也不知道，就会将请求转发到根域名服务器。请求会从根域名服务器开始一层一层向下转发，直到找到目标域名。找到目标域名后，请求途径的各个服务器都会将其数据放入本地的缓存中，以便下次使用。

## 浏览器与TCP

一次完整的请求包括请求与响应两部分。

### 请求部分

浏览器会将请求所需的数据打包，然后提供给传输层。

需要打包的数据往往包括：

1. 请求地址
2. 请求方法
3. 请求体
4. 请求头，请求头内是协议定义的控制信息，如：User-Agent、Host、Accept、Accept-Encoding等

数据打包好后会提供给TCP协议栈。TCP将数据放入TCP包内，TCP包内除了本身的请求数据，还额外增加了TCP头部。TCP头部主要包括：来源端口、目标端口、序列号、

### 响应部分