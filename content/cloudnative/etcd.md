+++

date = 2022-08-07T21:19:00+08:00
title = "etcd"
url = "/cloudnative/k8s/etcd"

toc = true

draft = true

+++



## 为什么集群中节点数量应为奇数

ectd要求选举时必须获取到半数以上的票。

### 两个节点VS一个节点

如果集群中有两个节点，这时两个节点都不能损坏，因为只存在一个节点没办法获取到半数以上的票。

如果一个节点损坏的概率为p，那么双节点集群不可用的概率为`1-(1-p)^2`，而单节点集群不可用的概率为`p`，令p为0.1，则双节点集群不可用的概率为0.19，而单节点集群不可用的概率为0.1. 

可见，双节点集群不可用的概率是大于单节点集群的。

### 四个节点vs三个节点

如果一个节点损坏

- 四节点集群还剩下三个节点，三个节点都必须存活集群才能正常
- 三节点集群还剩下两个节点，两个节点都必须存活集群才能正常

三个节点都正常的概率小于两个节点都正常的概率

因此三个节点的可用性高于四个节点。

### 六个节点vs五个节点

如果一个节点损坏

- 六节点集群还剩下五个节点，需要保证最少4个节点正常，可用概率为`(1-p)^4`
- 五节点集群还剩下四个节点，需要保证最少3个节点正常，可用概率为`(1-p)^3`

令前者可用概率为P1，后者可用概率为P2，则`P1-P2 = (1-p-1) (1-p)^3 < 0`，则P1<P2.

因此五个节点的可用性高于六个节点。
